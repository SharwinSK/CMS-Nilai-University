<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Attendance Tracker</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .container {
        padding: 20px;
      }

      .card {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: none;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
      }

      .card-header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        border-radius: 15px 15px 0 0 !important;
        padding: 20px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 25px;
        padding: 8px 20px;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .btn-success {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        transition: all 0.3s ease;
      }

      .btn-danger {
        background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        transition: all 0.3s ease;
      }

      .btn-warning {
        background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        transition: all 0.3s ease;
      }

      .table {
        border-radius: 10px;
        overflow: hidden;
      }

      .table thead th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px;
        text-align: center;
      }

      .table tbody td {
        vertical-align: middle;
        text-align: center;
        padding: 12px;
      }

      .attendance-cell {
        min-width: 100px;
      }

      .student-info {
        text-align: left !important;
      }

      .student-name {
        font-weight: bold;
        color: #333;
      }

      .student-id {
        color: #666;
        font-size: 0.9em;
      }

      .meeting-header {
        writing-mode: vertical-lr;
        text-orientation: mixed;
        min-width: 80px;
        font-size: 0.9em;
      }

      .stats-card {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        transition: all 0.3s ease;
      }

      .stats-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }

      .form-control,
      .form-select {
        border-radius: 25px;
        border: 2px solid #e9ecef;
        padding: 10px 15px;
        transition: all 0.3s ease;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }

      .animate-fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .meeting-date {
        font-size: 0.8em;
        color: #666;
        margin-top: 5px;
      }

      .export-btn {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }

      .table-responsive {
        max-height: 600px;
        overflow-y: auto;
      }

      .sticky-column {
        position: sticky;
        left: 0;
        background: white;
        z-index: 10;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card animate-fade-in">
            <div class="card-header">
              <h2 class="mb-0">
                <i class="fas fa-users me-2"></i>Student Attendance Tracker
              </h2>
              <div class="mt-2">
                <span
                  id="eventDisplay"
                  class="badge bg-light text-dark fs-6"
                ></span>
              </div>
            </div>
            <div class="card-body">
              <!-- Setup Section -->
              <div class="row mb-4">
                <div class="col-md-4">
                  <label class="form-label"
                    ><i class="fas fa-calendar-alt me-2"></i>Event Name</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="eventName"
                    placeholder="Enter event name"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label"
                    ><i class="fas fa-users me-2"></i>Number of Students</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="numStudents"
                    min="1"
                    max="100"
                    value="5"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label"
                    ><i class="fas fa-calendar-week me-2"></i>Number of
                    Meetings</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="numMeetings"
                    min="1"
                    max="50"
                    value="20"
                  />
                </div>
                <div class="col-md-2">
                  <label class="form-label">&nbsp;</label>
                  <button
                    class="btn btn-primary w-100"
                    onclick="setupAttendance()"
                  >
                    <i class="fas fa-play me-2"></i>Setup
                  </button>
                </div>
              </div>

              <!-- Statistics -->
              <div class="row mb-4" id="statsSection" style="display: none">
                <div class="col-md-3">
                  <div class="card stats-card">
                    <div class="card-body text-center">
                      <i class="fas fa-users fa-2x mb-2"></i>
                      <h5 id="totalStudents">0</h5>
                      <small>Total Students</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card stats-card">
                    <div class="card-body text-center">
                      <i class="fas fa-calendar-week fa-2x mb-2"></i>
                      <h5 id="totalMeetings">0</h5>
                      <small>Total Meetings</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card stats-card">
                    <div class="card-body text-center">
                      <i class="fas fa-percentage fa-2x mb-2"></i>
                      <h5 id="overallAttendance">0%</h5>
                      <small>Overall Attendance</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card stats-card">
                    <div class="card-body text-center">
                      <i class="fas fa-download fa-2x mb-2"></i>
                      <button
                        class="btn btn-success export-btn"
                        onclick="exportData()"
                      >
                        <i class="fas fa-file-export me-2"></i>Export
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Attendance Table -->
              <div id="attendanceSection" style="display: none">
                <div class="row mb-3">
                  <div class="col-md-8">
                    <h4>
                      <i class="fas fa-clipboard-check me-2"></i>Mark Attendance
                    </h4>
                  </div>
                  <div class="col-md-4">
                    <div class="btn-group w-100">
                      <button
                        class="btn btn-success"
                        onclick="markAllPresent()"
                      >
                        <i class="fas fa-check-double me-2"></i>All Present
                      </button>
                      <button class="btn btn-danger" onclick="markAllAbsent()">
                        <i class="fas fa-times me-2"></i>All Absent
                      </button>
                    </div>
                  </div>
                </div>

                <div class="table-responsive">
                  <table class="table table-striped" id="attendanceTable">
                    <thead>
                      <tr id="tableHeader">
                        <th class="sticky-column">Student Details</th>
                      </tr>
                    </thead>
                    <tbody id="attendanceBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.12/sweetalert2.all.min.js"></script>

    <script>
      let attendanceData = {};
      let students = [];
      let meetings = [];
      let eventName = "";

      function setupAttendance() {
        const eventNameInput = document
          .getElementById("eventName")
          .value.trim();
        const numStudents = parseInt(
          document.getElementById("numStudents").value
        );
        const numMeetings = parseInt(
          document.getElementById("numMeetings").value
        );

        if (!eventNameInput) {
          Swal.fire({
            icon: "error",
            title: "Missing Event Name",
            text: "Please enter an event name before setting up attendance.",
          });
          return;
        }

        if (numStudents < 1 || numMeetings < 1) {
          Swal.fire({
            icon: "error",
            title: "Invalid Input",
            text: "Please enter valid numbers for students and meetings.",
          });
          return;
        }

        eventName = eventNameInput;
        document.getElementById("eventDisplay").textContent = eventName;

        // Initialize students
        students = [];
        for (let i = 1; i <= numStudents; i++) {
          students.push({
            id: `STU${String(i).padStart(3, "0")}`,
            name: `Student ${i}`,
          });
        }

        // Initialize meetings
        meetings = [];
        for (let i = 1; i <= numMeetings; i++) {
          const meetingDate = new Date();
          meetingDate.setDate(meetingDate.getDate() + (i - 1) * 7); // Weekly meetings
          meetings.push({
            id: i,
            name: `Meeting ${i}`,
            date: meetingDate.toLocaleDateString(),
          });
        }

        // Initialize attendance data
        attendanceData = {};
        students.forEach((student) => {
          attendanceData[student.id] = {};
          meetings.forEach((meeting) => {
            attendanceData[student.id][meeting.id] = "absent";
          });
        });

        createAttendanceTable();
        updateStatistics();

        document.getElementById("statsSection").style.display = "block";
        document.getElementById("attendanceSection").style.display = "block";

        Swal.fire({
          icon: "success",
          title: "Setup Complete!",
          text: `Attendance tracker created for ${numStudents} students and ${numMeetings} meetings.`,
          timer: 2000,
          showConfirmButton: false,
        });
      }

      function createAttendanceTable() {
        const tableHeader = document.getElementById("tableHeader");
        const attendanceBody = document.getElementById("attendanceBody");

        // Clear existing content
        tableHeader.innerHTML =
          '<th class="sticky-column">Student Details</th>';
        attendanceBody.innerHTML = "";

        // Add meeting headers
        meetings.forEach((meeting) => {
          const th = document.createElement("th");
          th.className = "meeting-header";
          th.innerHTML = `
                    <div>${meeting.name}</div>
                    <div class="meeting-date">${meeting.date}</div>
                `;
          tableHeader.appendChild(th);
        });

        // Add student rows
        students.forEach((student) => {
          const row = document.createElement("tr");

          // Student info column
          const studentCell = document.createElement("td");
          studentCell.className = "student-info sticky-column";
          studentCell.innerHTML = `
                    <div class="student-name">${student.name}</div>
                    <div class="student-id">ID: ${student.id}</div>
                `;
          row.appendChild(studentCell);

          // Attendance columns
          meetings.forEach((meeting) => {
            const attendanceCell = document.createElement("td");
            attendanceCell.className = "attendance-cell";

            const status = attendanceData[student.id][meeting.id];
            const btnClass =
              status === "present"
                ? "btn-success"
                : status === "absent"
                ? "btn-danger"
                : "btn-warning";
            const btnText =
              status === "present"
                ? "Present"
                : status === "absent"
                ? "Absent"
                : "Late";
            const btnIcon =
              status === "present"
                ? "fa-check"
                : status === "absent"
                ? "fa-times"
                : "fa-clock";

            attendanceCell.innerHTML = `
                        <button class="btn ${btnClass} btn-sm" onclick="toggleAttendance('${student.id}', ${meeting.id})">
                            <i class="fas ${btnIcon} me-1"></i>${btnText}
                        </button>
                    `;

            row.appendChild(attendanceCell);
          });

          attendanceBody.appendChild(row);
        });
      }

      function toggleAttendance(studentId, meetingId) {
        const currentStatus = attendanceData[studentId][meetingId];
        let newStatus;

        if (currentStatus === "absent") {
          newStatus = "present";
        } else if (currentStatus === "present") {
          newStatus = "late";
        } else {
          newStatus = "absent";
        }

        attendanceData[studentId][meetingId] = newStatus;
        createAttendanceTable();
        updateStatistics();
      }

      function markAllPresent() {
        students.forEach((student) => {
          meetings.forEach((meeting) => {
            attendanceData[student.id][meeting.id] = "present";
          });
        });
        createAttendanceTable();
        updateStatistics();

        Swal.fire({
          icon: "success",
          title: "All Marked Present!",
          timer: 1500,
          showConfirmButton: false,
        });
      }

      function markAllAbsent() {
        students.forEach((student) => {
          meetings.forEach((meeting) => {
            attendanceData[student.id][meeting.id] = "absent";
          });
        });
        createAttendanceTable();
        updateStatistics();

        Swal.fire({
          icon: "info",
          title: "All Marked Absent!",
          timer: 1500,
          showConfirmButton: false,
        });
      }

      function updateStatistics() {
        document.getElementById("totalStudents").textContent = students.length;
        document.getElementById("totalMeetings").textContent = meetings.length;

        let totalPresent = 0;
        let totalSlots = 0;

        students.forEach((student) => {
          meetings.forEach((meeting) => {
            totalSlots++;
            if (attendanceData[student.id][meeting.id] === "present") {
              totalPresent++;
            }
          });
        });

        const attendancePercentage =
          totalSlots > 0 ? ((totalPresent / totalSlots) * 100).toFixed(1) : 0;
        document.getElementById(
          "overallAttendance"
        ).textContent = `${attendancePercentage}%`;
      }

      function exportData() {
        let csvContent = "data:text/csv;charset=utf-8,";

        // Header
        csvContent += "Event Name: " + eventName + "\n";
        csvContent += "Student ID,Student Name";
        meetings.forEach((meeting) => {
          csvContent += "," + meeting.name + " (" + meeting.date + ")";
        });
        csvContent += ",Total Present,Attendance %\n";

        // Data rows
        students.forEach((student) => {
          csvContent += student.id + "," + student.name;
          let presentCount = 0;

          meetings.forEach((meeting) => {
            const status = attendanceData[student.id][meeting.id];
            csvContent += "," + status;
            if (status === "present") presentCount++;
          });

          const attendancePercentage = (
            (presentCount / meetings.length) *
            100
          ).toFixed(1);
          csvContent += "," + presentCount + "," + attendancePercentage + "%\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `${eventName}_attendance.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        Swal.fire({
          icon: "success",
          title: "Data Exported!",
          text: "Attendance data has been downloaded as CSV file.",
          timer: 2000,
          showConfirmButton: false,
        });
      }

      // Initialize with default values
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("eventName").value = "Programming Course 2025";
      });
    </script>
  </body>
</html>
